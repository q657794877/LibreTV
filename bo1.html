<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘æ’­æ”¾å™¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/artplayer@5.0.5/dist/artplayer.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0a;
            overflow-x: hidden;
            height: 100vh;
            width: 100vw;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }
        
        #player {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 9999;
            background: #000;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            font-size: 1.5rem;
            color: white;
            background: #000;
            flex-direction: column;
        }
        
        .loading::after {
            content: "";
            width: 40px;
            height: 40px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid #fdbb2d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-top: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* è§†é¢‘åˆ—è¡¨é¡µé¢æ ·å¼ */
        .video-list-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #0a0a0a;
            overflow-y: auto;
            z-index: 10000;
            padding: 20px;
        }
        
        .video-list-container.show {
            display: block;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(253, 187, 45, 0.9);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
            display: none;
            transition: all 0.3s;
        }
        
        .back-button.show {
            display: block;
        }
        
        .back-button:hover {
            background: rgba(255, 204, 68, 0.95);
            transform: translateY(-2px);
        }
        
        .sections-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 60px 0 20px;
        }
        
        .section {
            margin-bottom: 50px;
            background: rgba(20, 20, 20, 0.8);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #fdbb2d;
            position: relative;
        }
        
        .section-title {
            font-size: 2.2rem;
            color: #fdbb2d;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            margin-right: 20px;
        }
        
        .categories-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-left: auto;
        }
        
        .category-tab {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #aaa;
            padding: 8px 18px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            white-space: nowrap;
        }
        
        .category-tab:hover {
            background: rgba(253, 187, 45, 0.15);
            color: #fdbb2d;
            border-color: rgba(253, 187, 45, 0.3);
            transform: translateY(-2px);
        }
        
        .category-tab.active {
            background: #fdbb2d;
            color: #000;
            border-color: #fdbb2d;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(253, 187, 45, 0.3);
        }
        
        .category-tab-more {
            background: transparent;
            border: 1px dashed rgba(255, 255, 255, 0.3);
            color: #888;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .category-tab-more:hover {
            border-color: #fdbb2d;
            color: #fdbb2d;
        }
        
        .videos-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            margin-top: 10px;
        }
        
        .video-card {
            background: rgba(30, 30, 30, 0.9);
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 320px;
            display: flex;
            flex-direction: column;
        }
        
        .video-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 35px rgba(253, 187, 45, 0.25);
            border-color: #fdbb2d;
            z-index: 2;
        }
        
        .video-poster-container {
            position: relative;
            height: 200px;
            overflow: hidden;
        }
        
        .video-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
            background: linear-gradient(135deg, #222, #333);
        }
        
        .video-card:hover .video-poster {
            transform: scale(1.05);
        }
        
        .play-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .video-card:hover .play-overlay {
            opacity: 1;
        }
        
        .play-icon {
            width: 50px;
            height: 50px;
            background: rgba(253, 187, 45, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #000;
            transform: scale(0.8);
            transition: transform 0.3s;
        }
        
        .video-card:hover .play-icon {
            transform: scale(1);
        }
        
        .video-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .video-title {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            line-height: 1.4;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 2.8em;
        }
        
        .video-meta {
            margin-top: auto;
            font-size: 0.85rem;
            color: #aaa;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .load-more-btn {
            grid-column: 1 / -1;
            background: rgba(253, 187, 45, 0.1);
            border: 2px solid #fdbb2d;
            color: #fdbb2d;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .load-more-btn:hover {
            background: rgba(253, 187, 45, 0.2);
            transform: translateY(-3px);
        }
        
        .no-videos {
            grid-column: 1 / -1;
            text-align: center;
            padding: 50px;
            color: #888;
            font-size: 1.1rem;
        }
        
        .search-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            z-index: 10001;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 20px;
            padding-left: 45px;
            border: 2px solid #fdbb2d;
            border-radius: 25px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 1rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            background: rgba(0, 0, 0, 0.9);
            box-shadow: 0 0 20px rgba(253, 187, 45, 0.4);
            width: 350px;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #fdbb2d;
            font-size: 1.2rem;
        }
        
        .search-results {
            display: none;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid #fdbb2d;
            border-radius: 10px;
            padding: 20px;
            margin-top: 10px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .search-results.show {
            display: block;
        }
        
        .search-results-title {
            font-size: 1.3rem;
            color: #fdbb2d;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(253, 187, 45, 0.3);
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(253, 187, 45, 0.5);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(253, 187, 45, 0.7);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1600px) {
            .videos-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        @media (max-width: 1200px) {
            .videos-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .video-card {
                height: 300px;
            }
            
            .video-poster-container {
                height: 180px;
            }
        }
        
        @media (max-width: 992px) {
            .videos-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .categories-tabs {
                margin-left: 0;
                margin-top: 15px;
                width: 100%;
                overflow-x: auto;
                padding-bottom: 5px;
            }
            
            .search-container {
                position: relative;
                width: 100%;
                margin-top: 20px;
                right: 0;
            }
            
            .search-input:focus {
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .videos-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .video-card {
                height: 280px;
            }
            
            .video-poster-container {
                height: 160px;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .video-list-container {
                padding: 15px;
            }
            
            .sections-container {
                padding-top: 40px;
            }
        }
        
        @media (max-width: 480px) {
            .videos-grid {
                grid-template-columns: 1fr;
            }
            
            .video-card {
                height: 260px;
            }
            
            .video-poster-container {
                height: 150px;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- æ’­æ”¾å™¨å®¹å™¨ -->
    <div id="player">
        <div class="loading">
            <span>æ­£åœ¨åŠ è½½...</span>
        </div>
    </div>
    
    <!-- è¿”å›æŒ‰é’® -->
    <button class="back-button" id="backButton">â† è¿”å›åˆ—è¡¨</button>
    
    <!-- è§†é¢‘åˆ—è¡¨å®¹å™¨ -->
    <div class="video-list-container" id="videoListContainer">
        <div class="search-container">
            <div class="search-box">
                <div class="search-icon">ğŸ”</div>
                <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢è§†é¢‘...">
            </div>
            <div class="search-results" id="searchResults">
                <!-- æœç´¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        
        <div class="sections-container" id="sectionsContainer">
            <!-- ç‰ˆå—å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- å¼•å…¥ç²¾ç®€ç‰ˆè§†é¢‘åˆ—è¡¨æ•°æ® -->
    <script src="http://v2.yuntv.vip/list.js"></script>
    <!-- å¼•å…¥HLS.jsåº“ä»¥æ”¯æŒM3U8æ ¼å¼ -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <!-- å¼•å…¥DASH.jsåº“ä»¥æ”¯æŒMPDæ ¼å¼ -->
    <script src="https://cdn.jsdelivr.net/npm/dashjs@latest/dist/dash.all.min.js"></script>
    <!-- å¼•å…¥Flv.jsåº“ä»¥æ”¯æŒFLVæ ¼å¼ -->
    <script src="https://cdn.jsdelivr.net/npm/flv.js@latest/dist/flv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/artplayer@5.0.5/dist/artplayer.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let artPlayer = null;
        let hls = null;
        let dashPlayer = null;
        let flvPlayer = null;
        
        // çŠ¶æ€ç®¡ç†
        let currentState = {
            isShowingList: false,
            searchKeyword: '',
            sectionStates: {} // å­˜å‚¨æ¯ä¸ªç‰ˆå—çš„çŠ¶æ€
        };
        
        // é…ç½®
        const CONFIG = {
            videosPerPage: 18, // æ¯é¡µæ˜¾ç¤ºçš„è§†é¢‘æ•° (3è¡Œ x 6åˆ—)
            loadMoreCount: 60, // æ¯æ¬¡åŠ è½½æ›´å¤šçš„è§†é¢‘æ•° (10è¡Œ x 6åˆ—)
            maxVisibleCategories: 8 // æœ€å¤šæ˜¾ç¤ºçš„åˆ†ç±»æ ‡ç­¾æ•°
        };
        
        // DOMå…ƒç´ 
        const playerElement = document.getElementById('player');
        const videoListContainer = document.getElementById('videoListContainer');
        const backButton = document.getElementById('backButton');
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const sectionsContainer = document.getElementById('sectionsContainer');
        
        // åˆ†ç±»å›¾æ ‡æ˜ å°„
        const categoryIcons = {
            'action': 'ğŸ’¥', 'comedy': 'ğŸ˜‚', 'romance': 'â¤ï¸', 'scifi': 'ğŸš€',
            'horror': 'ğŸ‘»', 'drama': 'ğŸ­', 'war': 'âš”ï¸', 'suspense': 'ğŸ”',
            'animation': 'ğŸ¨', 'documentary': 'ğŸ“½ï¸',
            'chinese': 'ğŸ‡¨ğŸ‡³', 'hk_tw': 'ğŸ‡­ğŸ‡°', 'western': 'ğŸŒ',
            'china': 'ğŸ‰', 'japan': 'ğŸ‡¯ğŸ‡µ', 'west_anime': 'ğŸ¤–'
        };
        
        // åˆå§‹åŒ–ç‰ˆå—çŠ¶æ€
        function initSectionState(sectionId) {
            if (!currentState.sectionStates[sectionId]) {
                const categories = VideoListUtils.getCategories(sectionId);
                const firstCategory = categories[0];
                
                currentState.sectionStates[sectionId] = {
                    activeCategory: firstCategory ? firstCategory.id : null,
                    visibleCategories: categories.slice(0, CONFIG.maxVisibleCategories),
                    hiddenCategories: categories.slice(CONFIG.maxVisibleCategories),
                    visibleVideos: CONFIG.videosPerPage,
                    allVideos: []
                };
            }
        }
        
        // è§£æURLå‚æ•°
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const videoParam = params.get('video');
            
            if (videoParam) {
                return {
                    url: videoParam,
                    poster: params.get('poster') || '',
                    title: params.get('title') || 'è§†é¢‘',
                    type: detectVideoType(videoParam)
                };
            }
            
            return null;
        }
        
        // æ£€æµ‹è§†é¢‘ç±»å‹
        function detectVideoType(url) {
            const urlLower = url.toLowerCase();
            
            if (urlLower.endsWith('.m3u8') || urlLower.includes('.m3u8?')) {
                return 'hls';
            }
            
            if (urlLower.endsWith('.mpd') || urlLower.includes('.mpd?')) {
                return 'dash';
            }
            
            if (urlLower.endsWith('.flv') || urlLower.includes('.flv?')) {
                return 'flv';
            }
            
            const videoExtensions = ['.mp4', '.webm', '.mkv', '.avi', '.mov', '.wmv', '.3gp', '.ogg', '.ogv'];
            for (const ext of videoExtensions) {
                if (urlLower.endsWith(ext) || urlLower.includes(ext + '?')) {
                    return 'video';
                }
            }
            
            return 'video';
        }
        
        // éªŒè¯URLæ˜¯å¦æœ‰æ•ˆ
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            playerElement.innerHTML = `
                <div class="loading">
                    <div style="text-align:center; max-width: 500px; margin: 0 auto;">
                        <h3 style="color:#ff6b6b;margin-bottom:20px;">${message}</h3>
                        <p style="margin-bottom:25px;color:#ccc;">è¯·é€šè¿‡URLå‚æ•°æä¾›è§†é¢‘åœ°å€æˆ–è¿”å›åˆ—è¡¨é€‰æ‹©è§†é¢‘</p>
                        <button onclick="showVideoList()" style="background:#fdbb2d;color:#000;border:none;padding:12px 30px;border-radius:6px;font-weight:bold;cursor:pointer;font-size:1rem;transition:all 0.3s;" 
                                onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 5px 15px rgba(253, 187, 45, 0.3)'"
                                onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">
                            è¿”å›è§†é¢‘åˆ—è¡¨
                        </button>
                    </div>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            playerElement.innerHTML = `
                <div class="loading">
                    <span>æ­£åœ¨åŠ è½½è§†é¢‘...</span>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºè§†é¢‘åˆ—è¡¨
        function showVideoList() {
            currentState.isShowingList = true;
            videoListContainer.classList.add('show');
            backButton.classList.add('show');
            renderSections();
        }
        
        // éšè—è§†é¢‘åˆ—è¡¨
        function hideVideoList() {
            currentState.isShowingList = false;
            videoListContainer.classList.remove('show');
            backButton.classList.remove('show');
            clearSearch();
        }
        
        // æ¸²æŸ“ç‰ˆå—
        function renderSections() {
            const sections = VideoListUtils.getSections();
            
            let html = '';
            
            sections.forEach(section => {
                initSectionState(section.id);
                const sectionState = currentState.sectionStates[section.id];
                const categories = VideoListUtils.getCategories(section.id);
                
                // æ„å»ºåˆ†ç±»æ ‡ç­¾
                let categoriesTabsHtml = '';
                
                // æ˜¾ç¤ºçš„åˆ†ç±»
                sectionState.visibleCategories.forEach(category => {
                    const isActive = category.id === sectionState.activeCategory;
                    const icon = categoryIcons[category.id] || 'ğŸ¬';
                    categoriesTabsHtml += `
                        <div class="category-tab ${isActive ? 'active' : ''}" 
                             onclick="switchCategory('${section.id}', '${category.id}')">
                            ${icon} ${category.name}
                        </div>
                    `;
                });
                
                // éšè—çš„åˆ†ç±»ï¼ˆæ›´å¤šæŒ‰é’®ï¼‰
                if (sectionState.hiddenCategories.length > 0) {
                    categoriesTabsHtml += `
                        <div class="category-tab-more" onclick="showMoreCategories('${section.id}')">
                            +${sectionState.hiddenCategories.length}æ›´å¤š
                        </div>
                    `;
                }
                
                // è·å–å½“å‰åˆ†ç±»çš„è§†é¢‘
                const videos = sectionState.activeCategory ? 
                    VideoListUtils.getVideos(section.id, sectionState.activeCategory) : [];
                
                // é™åˆ¶æ˜¾ç¤ºçš„è§†é¢‘æ•°é‡
                const visibleVideos = videos.slice(0, sectionState.visibleVideos);
                
                // æ„å»ºè§†é¢‘ç½‘æ ¼
                let videosHtml = '';
                
                if (visibleVideos.length > 0) {
                    visibleVideos.forEach(video => {
                        videosHtml += `
                            <div class="video-card" onclick="playVideo('${video.id}')">
                                <div class="video-poster-container">
                                    <img src="${video.poster}" alt="${video.title}" class="video-poster" 
                                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSIzMjAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMWUxZTFmIi8+CiAgICA8dGV4dCB4PSIxNjAiIHk9IjEwMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zZW0iPgogICAgICAgICR7dmlkZW8udGl0bGV9CiAgICA8L3RleHQ+Cjwvc3ZnPg==';">
                                    <div class="play-overlay">
                                        <div class="play-icon">â–¶</div>
                                    </div>
                                </div>
                                <div class="video-info">
                                    <div class="video-title">${video.title}</div>
                                    <div class="video-meta">
                                        <span>${section.name}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    // åŠ è½½æ›´å¤šæŒ‰é’®
                    if (videos.length > sectionState.visibleVideos) {
                        videosHtml += `
                            <div class="load-more-btn" onclick="loadMoreVideos('${section.id}')">
                                åŠ è½½æ›´å¤šï¼ˆ${videos.length - sectionState.visibleVideos}ä¸ªï¼‰
                            </div>
                        `;
                    }
                } else {
                    videosHtml = `<div class="no-videos">æš‚æ— è§†é¢‘</div>`;
                }
                
                html += `
                    <div class="section" id="section-${section.id}">
                        <div class="section-header">
                            <div class="section-title">${section.name}</div>
                            <div class="categories-tabs">
                                ${categoriesTabsHtml}
                            </div>
                        </div>
                        <div class="videos-grid">
                            ${videosHtml}
                        </div>
                    </div>
                `;
            });
            
            sectionsContainer.innerHTML = html;
            searchResults.classList.remove('show');
        }
        
        // åˆ‡æ¢åˆ†ç±»
        function switchCategory(sectionId, categoryId) {
            const sectionState = currentState.sectionStates[sectionId];
            sectionState.activeCategory = categoryId;
            sectionState.visibleVideos = CONFIG.videosPerPage; // é‡ç½®æ˜¾ç¤ºæ•°é‡
            renderSections();
            
            // æ»šåŠ¨åˆ°è¯¥ç‰ˆå—
            const sectionElement = document.getElementById(`section-${sectionId}`);
            if (sectionElement) {
                sectionElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        // æ˜¾ç¤ºæ›´å¤šåˆ†ç±»
        function showMoreCategories(sectionId) {
            const sectionState = currentState.sectionStates[sectionId];
            
            // å°†éšè—çš„åˆ†ç±»ç§»åŠ¨åˆ°å¯è§åˆ†ç±»
            const moveCount = Math.min(5, sectionState.hiddenCategories.length);
            const movedCategories = sectionState.hiddenCategories.splice(0, moveCount);
            sectionState.visibleCategories.push(...movedCategories);
            
            renderSections();
        }
        
        // åŠ è½½æ›´å¤šè§†é¢‘
        function loadMoreVideos(sectionId) {
            const sectionState = currentState.sectionStates[sectionId];
            sectionState.visibleVideos += CONFIG.loadMoreCount;
            renderSections();
        }
        
        // æœç´¢è§†é¢‘
        function searchVideos(keyword) {
            currentState.searchKeyword = keyword;
            
            if (!keyword.trim()) {
                searchResults.classList.remove('show');
                renderSections();
                return;
            }
            
            const results = VideoListUtils.searchVideos(keyword);
            
            if (results.length === 0) {
                searchResults.innerHTML = `
                    <div class="search-results-title">æœç´¢"${keyword}"çš„ç»“æœ</div>
                    <div class="no-videos">æœªæ‰¾åˆ°ç›¸å…³è§†é¢‘</div>
                `;
            } else {
                let resultsHtml = `
                    <div class="search-results-title">æœç´¢"${keyword}"çš„ç»“æœ (${results.length}ä¸ª)</div>
                    <div class="videos-grid" style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
                `;
                
                results.forEach(video => {
                    resultsHtml += `
                        <div class="video-card" onclick="playVideo('${video.id}')">
                            <div class="video-poster-container">
                                <img src="${video.poster}" alt="${video.title}" class="video-poster" 
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxyZWN0IHdpZHRoPSIzMjAiIGhlaWdodD0iMjAwIiBmaWxsPSIjMWUxZTFmIi8+CiAgICA8dGV4dCB4PSIxNjAiIHk9IjEwMCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE2IiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zZW0iPgogICAgICAgICR7dmlkZW8udGl0bGV9CiAgICA8L3RleHQ+Cjwvc3ZnPg==';">
                                <div class="play-overlay">
                                    <div class="play-icon">â–¶</div>
                                </div>
                            </div>
                            <div class="video-info">
                                <div class="video-title">${video.title}</div>
                                <div class="video-meta">
                                    <span>${video.section} â€¢ ${video.category}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                resultsHtml += '</div>';
                searchResults.innerHTML = resultsHtml;
            }
            
            searchResults.classList.add('show');
            sectionsContainer.innerHTML = '';
        }
        
        // æ¸…é™¤æœç´¢
        function clearSearch() {
            searchInput.value = '';
            searchResults.classList.remove('show');
            currentState.searchKeyword = '';
        }
        
        // æ’­æ”¾è§†é¢‘
        function playVideo(videoId) {
            const videoInfo = VideoListUtils.getVideoById(videoId);
            
            if (videoInfo) {
                hideVideoList();
                initPlayer({
                    url: videoInfo.url,
                    poster: videoInfo.poster,
                    title: videoInfo.title,
                    type: detectVideoType(videoInfo.url)
                });
            } else {
                showError('è§†é¢‘ä¿¡æ¯è·å–å¤±è´¥');
            }
        }
        
        // åˆå§‹åŒ–æ’­æ”¾å™¨
        async function initPlayer(videoSource) {
            try {
                showLoading();
                
                if (!videoSource.url || !isValidUrl(videoSource.url)) {
                    throw new Error('è§†é¢‘URLæ— æ•ˆ');
                }
                
                if (artPlayer) {
                    artPlayer.destroy();
                }
                
                if (hls) {
                    hls.destroy();
                    hls = null;
                }
                if (dashPlayer) {
                    dashPlayer.destroy();
                    dashPlayer = null;
                }
                if (flvPlayer) {
                    flvPlayer.destroy();
                    flvPlayer = null;
                }
                
                // åˆ›å»ºæ’­æ”¾å™¨é…ç½®
                const playerConfig = {
                    container: '#player',
                    url: videoSource.url,
                    poster: videoSource.poster || '',
                    title: videoSource.title || 'è§†é¢‘',
                    volume: 0.5,
                    isLive: false,
                    muted: false,
                    autoplay: false,
                    pip: true,
                    autoSize: true,
                    autoMini: true,
                    screenshot: true,
                    setting: true,
                    loop: false,
                    flip: true,
                    playbackRate: true,
                    aspectRatio: true,
                    fullscreen: true,
                    fullscreenWeb: true,
                    subtitleOffset: true,
                    miniProgressBar: false,
                    mutex: true,
                    backdrop: true,
                    playsInline: true,
                    theme: '#fdbb2d',
                    moreVideoAttr: {
                        crossOrigin: 'anonymous'
                    },
                    settings: [
                        {
                            width: 200,
                            html: 'æ’­æ”¾é€Ÿåº¦',
                            tooltip: 'Speed',
                            icon: '<i>â©</i>',
                            selector: [
                                { html: '0.5x', value: 0.5 },
                                { html: '0.75x', value: 0.75 },
                                { default: true, html: 'æ­£å¸¸', value: 1 },
                                { html: '1.25x', value: 1.25 },
                                { html: '1.5x', value: 1.5 },
                                { html: '2.0x', value: 2 },
                            ],
                            onSelect: function (item) {
                                artPlayer.playbackRate = item.value;
                                return item.html;
                            },
                        },
                        {
                            width: 200,
                            html: 'ç”»é¢ç¿»è½¬',
                            tooltip: 'Flip',
                            icon: '<i>ğŸ”„</i>',
                            selector: [
                                { default: true, html: 'æ­£å¸¸', value: 'none' },
                                { html: 'æ°´å¹³ç¿»è½¬', value: 'horizontal' },
                                { html: 'å‚ç›´ç¿»è½¬', value: 'vertical' },
                            ],
                            onSelect: function (item) {
                                artPlayer.flip = item.value;
                                return item.html;
                            },
                        },
                        {
                            width: 200,
                            html: 'è¿”å›åˆ—è¡¨',
                            tooltip: 'Back to List',
                            icon: '<i>ğŸ“‹</i>',
                            click: function () {
                                showVideoList();
                            }
                        }
                    ],
                    icons: {
                        loading: '<div style="width:24px;height:24px;border:2px solid #fdbb2d;border-radius:50%;border-top-color:transparent;animation:spin 1s linear infinite;"></div>',
                        play: '<i>â–¶ï¸</i>',
                        pause: '<i>â¸ï¸</i>',
                        volume: '<i>ğŸ”Š</i>',
                        volumeClose: '<i>ğŸ”‡</i>',
                        screenshot: '<i>ğŸ“·</i>',
                        setting: '<i>âš™ï¸</i>',
                        pip: '<i>ğŸ“Œ</i>',
                        fullscreenOn: '<i>â›¶</i>',
                        fullscreenOff: '<i>â›·ï¸</i>',
                        playbackRate: '<i>â©</i>',
                    },
                };
                
                artPlayer = new Artplayer(playerConfig);
                
                const videoType = videoSource.type || detectVideoType(videoSource.url);
                
                // æ ¹æ®è§†é¢‘ç±»å‹åˆå§‹åŒ–ç›¸åº”çš„æ’­æ”¾å™¨
                switch (videoType) {
                    case 'hls':
                        await initHLSPlayer(videoSource.url);
                        break;
                    case 'dash':
                        await initDASHPlayer(videoSource.url);
                        break;
                    case 'flv':
                        await initFLVPlayer(videoSource.url);
                        break;
                    default:
                        break;
                }
                
                artPlayer.on('video:error', (error) => {
                    console.error('è§†é¢‘åŠ è½½é”™è¯¯:', error);
                    showError('è§†é¢‘æ’­æ”¾å‡ºé”™: ' + error.message);
                });
                
                artPlayer.on('destroy', () => {
                    destroyStreamingPlayers();
                });
                
                return artPlayer;
            } catch (error) {
                console.error('æ’­æ”¾å™¨åˆå§‹åŒ–é”™è¯¯:', error);
                showError(error.message);
                return null;
            }
        }
        
        // åˆå§‹åŒ–HLSæ’­æ”¾å™¨
        async function initHLSPlayer(url) {
            if (Hls.isSupported()) {
                hls = new Hls({
                    enableWorker: false,
                    lowLatencyMode: true,
                    backBufferLength: 90
                });
                
                hls.loadSource(url);
                hls.attachMedia(artPlayer.video);
                
                hls.on(Hls.Events.ERROR, function(event, data) {
                    console.error('HLSé”™è¯¯:', data);
                    if (data.fatal) {
                        showError('HLSæ’­æ”¾å™¨å‘ç”Ÿé”™è¯¯');
                    }
                });
            } else if (artPlayer.video.canPlayType('application/vnd.apple.mpegurl')) {
                artPlayer.video.src = url;
            } else {
                throw new Error('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒHLSæ’­æ”¾');
            }
        }
        
        // åˆå§‹åŒ–DASHæ’­æ”¾å™¨
        async function initDASHPlayer(url) {
            if (dashjs.MediaPlayer.isSupported()) {
                dashPlayer = dashjs.MediaPlayer().create();
                dashPlayer.initialize(artPlayer.video, url, false);
                
                dashPlayer.on('error', function(e) {
                    console.error('DASHé”™è¯¯:', e);
                    showError('DASHæµåª’ä½“æ’­æ”¾é”™è¯¯');
                });
            } else {
                throw new Error('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒDASHæ’­æ”¾');
            }
        }
        
        // åˆå§‹åŒ–FLVæ’­æ”¾å™¨
        async function initFLVPlayer(url) {
            if (flvjs.isSupported()) {
                flvPlayer = flvjs.createPlayer({
                    type: 'flv',
                    url: url
                });
                flvPlayer.attachMediaElement(artPlayer.video);
                flvPlayer.load();
                
                flvPlayer.on(flvjs.Events.ERROR, function(e) {
                    console.error('FLVé”™è¯¯:', e);
                    showError('FLVæµåª’ä½“æ’­æ”¾é”™è¯¯');
                });
            } else {
                throw new Error('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒFLVæ’­æ”¾');
            }
        }
        
        // é”€æ¯æµåª’ä½“æ’­æ”¾å™¨
        function destroyStreamingPlayers() {
            if (hls) {
                hls.destroy();
                hls = null;
            }
            if (dashPlayer) {
                dashPlayer.destroy();
                dashPlayer = null;
            }
            if (flvPlayer) {
                flvPlayer.destroy();
                flvPlayer = null;
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šäº‹ä»¶
            backButton.addEventListener('click', hideVideoList);
            
            searchInput.addEventListener('input', function(e) {
                searchVideos(e.target.value);
            });
            
            // ç›‘å¬å›è½¦é”®æœç´¢
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchVideos(this.value);
                }
            });
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­æœç´¢ç»“æœ
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    if (!currentState.searchKeyword) {
                        searchResults.classList.remove('show');
                    }
                }
            });
            
            // æ£€æŸ¥URLå‚æ•°
            setTimeout(() => {
                const urlParams = getUrlParams();
                
                if (urlParams) {
                    initPlayer(urlParams);
                } else {
                    showVideoList();
                }
            }, 500);
        });
    </script>
</body>
</html>